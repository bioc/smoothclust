---
title: "Smoothclust Tutorial"
author: 
  - name: Lukas M. Weber
    affiliation: "Boston University"
package: smoothclust
output: 
  BiocStyle::html_document: 
    toc_float: true
vignette: >
  %\VignetteIndexEntry{Smoothclust Tutorial}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


# Introduction

`smoothclust` is a spatial clustering algorithm for spatial transcriptomics data.


# Installation

To add


# Input data format

To add


# Tutorial

```{r, message=FALSE}
library(smoothclust)
library(STexampleData)
library(scuttle)
library(scran)
library(scater)
library(ggspavis)
```

```{r}
# load data
spe <- Visium_humanDLPFC()

# keep spots over tissue
spe <- spe[, colData(spe)$in_tissue == 1]

dim(spe)
```

```{r}
# run smoothclust
spe <- smoothclust(spe, method = "uniform", bandwidth = 0.04)
```

```{r}
# calculate logcounts
spe <- logNormCounts(spe)
```

```{r}
# preprocessing for downstream clustering

# remove mitochondrial genes
is_mito <- grepl("(^MT-)|(^mt-)", rowData(spe)$gene_name)
table(is_mito)
spe <- spe[!is_mito, ]
dim(spe)

# select top highly variable genes (HVGs)
dec <- modelGeneVar(spe)
top_hvgs <- getTopHVGs(dec, prop = 0.1)
length(top_hvgs)
spe <- spe[top_hvgs, ]
dim(spe)
```

```{r}
# dimensionality reduction

# compute PCA
set.seed(123)
spe <- runPCA(spe)
```

```{r}
# run k-means clustering
set.seed(123)
k <- 7
clust <- kmeans(reducedDim(spe, "PCA"), centers = k)$cluster
table(clust)
colLabels(spe) <- factor(clust)
```

```{r}
# plot clusters
pal8 <- "libd_layer_colors"
pal36 <- unname(palette.colors(36, "Polychrome 36"))

plotSpots(spe, annotate = "label", palette = pal8)
```


# Session information

```{r}
sessionInfo()
```
